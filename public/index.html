<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create UI</title>

<style>
/* Reset */
*{ margin:0; padding:0; box-sizing:border-box; font-family: Arial, Helvetica, sans-serif; }

/* Body */
body{ background:#000; display:flex; justify-content:center; align-items:center; min-height:100vh; }

/* Main Container */
.container{ width:95%; max-width:420px; background:#0f0f0f; padding:20px; border-radius:25px; }

/* Top Section (Upload + Input) */
.top-section{ display:flex; gap:15px; }

/* Upload Box */
.upload-box{
    width:70px; height:70px; background:#1a1a1a; border-radius:20px;
    display:flex; align-items:center; justify-content:center;
    font-size:28px; color:#888; cursor:pointer; position:relative; overflow:hidden; flex-shrink: 0;
}
.upload-box input{ position:absolute; width:100%; height:100%; opacity:0; cursor:pointer; }
.upload-box img{ width:100%; height:100%; object-fit:cover; border-radius:20px; display:none; }

/* Input Box - Changed to textarea for actual typing */
.input-box{
    flex:1; background:#1a1a1a; border-radius:20px; padding:15px;
    color:#fff; font-size:16px; border:none; resize:none; outline:none;
}
.input-box::placeholder { color: #888; }

/* Controls Section */
.controls{ margin-top:20px; display:flex; justify-content:space-between; align-items:center; }

/* Audio Toggle */
.audio-toggle{ background:#1f1f1f; padding:10px 15px; border-radius:25px; display:flex; align-items:center; gap:10px; color:#fff; cursor: pointer; user-select: none; }

/* Switch & Switch Off State */
.switch{
    width:50px; height:25px; background:linear-gradient(45deg,#ff9a44,#ff4ecb);
    border-radius:50px; position:relative; transition: background 0.3s;
}
.switch::after{
    content:""; width:20px; height:20px; background:#fff; border-radius:50%;
    position:absolute; right:3px; top:2.5px; transition: all 0.3s;
}
.switch.off { background: #444; }
.switch.off::after { right: 27px; }

/* Timer */
.timer{ background:#1f1f1f; padding:10px 15px; border-radius:25px; color:#fff; }

/* Create Button */
.create-btn{
    margin-top:20px; width:100%; padding:15px; border:none; border-radius:30px;
    font-size:18px; font-weight:bold; color:#fff; cursor:pointer; transition:0.3s ease;
    background:linear-gradient(90deg,#ff9a44,#ff4ecb,#7a5cff);
}
.create-btn:hover{ opacity:0.9; }
.create-btn:disabled { opacity: 0.5; cursor: not-allowed; }
</style>
</head>

<body>

<div class="container">
    <div class="top-section">
        <label class="upload-box">
            +
            <input type="file" accept="image/*" id="imageInput" onchange="previewImage(event)">
            <img id="preview">
        </label>

        <textarea id="promptInput" class="input-box" rows="3" placeholder="Describe the content you want to create"></textarea>
    </div>

    <div class="controls">
        <div class="audio-toggle" onclick="toggleAudio()">
            Audio
            <div id="audioSwitch" class="switch"></div>
        </div>

        <div class="timer">‚è± 10s</div>
    </div>

    <button id="createBtn" class="create-btn" onclick="generateContent()">Create</button>
</div>

<script>
// State Variables
let currentImageBase64 = null;
let isAudioEnabled = true;

// 1. Handle Image Preview & convert to Base64 to send to API
function previewImage(event){
    const file = event.target.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = function(e){
        const img = document.getElementById("preview");
        img.src = e.target.result;
        img.style.display = "block";
        currentImageBase64 = e.target.result; // Save for the API call
    }
    reader.readAsDataURL(file);
}

// 2. Handle Audio Toggle UI
function toggleAudio() {
    isAudioEnabled = !isAudioEnabled;
    const switchEl = document.getElementById('audioSwitch');
    if (isAudioEnabled) {
        switchEl.classList.remove('off');
    } else {
        switchEl.classList.add('off');
    }
}

// 3. Handle 'Create' Button Click and API Call
async function generateContent() {
    const promptText = document.getElementById('promptInput').value;
    const createBtn = document.getElementById('createBtn');

    if (!promptText.trim() && !currentImageBase64) {
        alert("Please upload an image or enter a prompt!");
        return;
    }

    // Set loading state
    createBtn.disabled = true;
    createBtn.innerText = "Generating...";

    try {
        // Send data to our Vercel Serverless Function
        const response = await fetch('/api/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                image: currentImageBase64,
                prompt: promptText,
                audio: isAudioEnabled,
                duration: "10s"
            })
        });

        const data = await response.json();
        
        if (data.success) {
            alert(data.message); // Replace this with your actual UI success state
            console.log("Mock Video URL:", data.mockResultUrl);
        } else {
            alert("Error generating content.");
        }

    } catch (error) {
        console.error("API Error:", error);
        alert("Something went wrong.");
    } finally {
        // Reset button state
        createBtn.disabled = false;
        createBtn.innerText = "Create";
    }
}
</script>

</body>
</html>
